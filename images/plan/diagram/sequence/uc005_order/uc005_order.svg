<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1297px" preserveAspectRatio="none" style="width:964px;height:1297px;background:#FFFFFF;" version="1.1" viewBox="0 0 964 1297" width="964px" zoomAndPan="magnify"><defs/><g><rect height="26.4883" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="210" x="370.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="200" x="375.5" y="28.5352">UC005: 購入確定 シーケンス図</text><rect fill="#FFFFFF" height="1073.8008" style="stroke:#A80036;stroke-width:1.0;" width="10" x="24" y="131.9766"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171" y="153.2871"/><rect fill="#FFFFFF" height="830.9717" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171" y="264.874"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171" y="1125.1563"/><rect fill="#FFFFFF" height="677.1084" style="stroke:#A80036;stroke-width:1.0;" width="10" x="312" y="389.4268"/><rect fill="#FFFFFF" height="39.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="475" y="577.2559"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="555.5" y="657.1875"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="655.5" y="774.4297"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="764" y="444.7031"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="764" y="891.6719"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="474.0137"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="686.498"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="803.7402"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="920.9824"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="29" x2="29" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="176" x2="176" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="317" x2="317" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="480" x2="480" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="560" x2="560" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="660" x2="660" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="769" x2="769" y1="121.9766" y2="1214.7773"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="929" x2="929" y1="121.9766" y2="1214.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="5" y="119.0234">ユーザ</text><ellipse cx="29" cy="52.4883" fill="#FEFECE" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M29,60.4883 L29,87.4883 M16,68.4883 L42,68.4883 M29,87.4883 L16,102.4883 M29,87.4883 L42,102.4883 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="5" y="1227.3125">ユーザ</text><ellipse cx="29" cy="1240.2656" fill="#FEFECE" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M29,1248.2656 L29,1275.2656 M16,1256.2656 L42,1256.2656 M29,1275.2656 L16,1290.2656 M29,1275.2656 L42,1290.2656 " fill="none" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="84" x="134" y="74"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="156" y="94.5352">Order</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="141" y="111.0234">Controller</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="84" x="134" y="1213.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="156" y="1234.3125">Order</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="141" y="1250.8008">Controller</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="62" x="286" y="74"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="297" y="94.5352">Order</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="293" y="111.0234">Service</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="62" x="286" y="1213.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="297" y="1234.3125">Order</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="293" y="1250.8008">Service</text><rect fill="#FEFECE" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="453" y="90.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="460" y="111.0234">Order</text><rect fill="#FEFECE" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="453" y="1213.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="460" y="1234.3125">Order</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="87" x="517" y="74"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="540.5" y="94.5352">Order</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="524" y="111.0234">Repository</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="87" x="517" y="1213.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="540.5" y="1234.3125">Order</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="524" y="1250.8008">Repository</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="93" x="614" y="74"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="621" y="94.5352">OrderDetail</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="624" y="111.0234">Repository</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="93" x="614" y="1213.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="621" y="1234.3125">OrderDetail</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="624" y="1250.8008">Repository</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="104" x="717" y="74"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="724" y="94.5352">ProductStock</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="732.5" y="111.0234">Repository</text><rect fill="#FEFECE" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="104" x="717" y="1213.7773"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="724" y="1234.3125">ProductStock</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="732.5" y="1250.8008">Repository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="18" x="917" y="119.0234">DB</text><path d="M911,69.4883 C911,59.4883 929,59.4883 929,59.4883 C929,59.4883 947,59.4883 947,69.4883 L947,95.4883 C947,105.4883 929,105.4883 929,105.4883 C929,105.4883 911,105.4883 911,95.4883 L911,69.4883 " fill="#FEFECE" style="stroke:#A80036;stroke-width:1.5;"/><path d="M911,69.4883 C911,79.4883 929,79.4883 929,79.4883 C929,79.4883 947,79.4883 947,69.4883 " fill="none" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="18" x="917" y="1227.3125">DB</text><path d="M911,1240.2656 C911,1230.2656 929,1230.2656 929,1230.2656 C929,1230.2656 947,1230.2656 947,1240.2656 L947,1266.2656 C947,1276.2656 929,1276.2656 929,1276.2656 C929,1276.2656 911,1276.2656 911,1266.2656 L911,1240.2656 " fill="#FEFECE" style="stroke:#A80036;stroke-width:1.5;"/><path d="M911,1240.2656 C911,1250.2656 929,1250.2656 929,1250.2656 C929,1250.2656 947,1250.2656 947,1240.2656 " fill="none" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FFFFFF" height="1073.8008" style="stroke:#A80036;stroke-width:1.0;" width="10" x="24" y="131.9766"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171" y="153.2871"/><rect fill="#FFFFFF" height="830.9717" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171" y="264.874"/><rect fill="#FFFFFF" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="171" y="1125.1563"/><rect fill="#FFFFFF" height="677.1084" style="stroke:#A80036;stroke-width:1.0;" width="10" x="312" y="389.4268"/><rect fill="#FFFFFF" height="39.9658" style="stroke:#A80036;stroke-width:1.0;" width="10" x="475" y="577.2559"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="555.5" y="657.1875"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="655.5" y="774.4297"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="764" y="444.7031"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="764" y="891.6719"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="474.0137"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="686.498"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="803.7402"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="924" y="920.9824"/><polygon fill="#A80036" points="159,149.2871,169,153.2871,159,157.2871,163,153.2871" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="34" x2="165" y1="153.2871" y2="153.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="41" y="148.5449">confirm(productId)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="181" x2="223" y1="182.5977" y2="182.5977"/><line style="stroke:#A80036;stroke-width:1.0;" x1="223" x2="223" y1="182.5977" y2="195.5977"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182" x2="223" y1="195.5977" y2="195.5977"/><polygon fill="#A80036" points="192,191.5977,182,195.5977,192,199.5977,188,195.5977" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="188" y="177.8555">カートの中身を表示</text><polygon fill="#A80036" points="45,220.9082,35,224.9082,45,228.9082,41,224.9082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="39" x2="175" y1="224.9082" y2="224.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="51" y="220.166">確認画面</text><polygon fill="#A80036" points="159,260.874,169,264.874,159,268.874,163,264.874" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="34" x2="165" y1="264.874" y2="264.874"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="41" y="260.1318">execute()</text><path d="M186,237.9082 L186,277.9082 L324,277.9082 L324,247.9082 L314,237.9082 L186,237.9082 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><path d="M314,237.9082 L314,247.9082 L324,247.9082 L314,237.9082 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="192" y="255.4766">未ログインだったら</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="192" y="270.7871">ログイン画面を出す</text><polygon fill="#A80036" points="468,300.8398,478,304.8398,468,308.8398,472,304.8398" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="181" x2="474" y1="304.8398" y2="304.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="188" y="300.0977">new(カート内容をエンティティに変換)</text><polygon fill="#A80036" points="192,330.1504,182,334.1504,192,338.1504,188,334.1504" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="186" x2="479" y1="334.1504" y2="334.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="198" y="329.4082">Order</text><polygon fill="#A80036" points="300,385.4268,310,389.4268,300,393.4268,304,389.4268" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="181" x2="306" y1="389.4268" y2="389.4268"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="188" y="384.6846">addOrder(Order)</text><path d="M327,347.1504 L327,418.1504 L491,418.1504 L491,357.1504 L481,347.1504 L327,347.1504 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><path d="M481,347.1504 L481,357.1504 L491,357.1504 L481,347.1504 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="333" y="364.7188">・在庫数を取得して</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="333" y="380.0293">　購入できるか確認</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="333" y="395.3398">　（悲観的ロック）</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="333" y="410.6504">・トランザクション処理</text><polygon fill="#A80036" points="752,440.7031,762,444.7031,752,448.7031,756,444.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="322" x2="758" y1="444.7031" y2="444.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="329" y="439.9609">selectStockList(List&lt;Product&gt;)</text><polygon fill="#A80036" points="912,470.0137,922,474.0137,912,478.0137,916,474.0137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="774" x2="918" y1="474.0137" y2="474.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="781" y="469.2715">SQL(SELECT)</text><polygon fill="#A80036" points="785,499.3242,775,503.3242,785,507.3242,781,503.3242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="779" x2="928" y1="503.3242" y2="503.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="791" y="498.582">List&lt;ProductStock&gt;</text><polygon fill="#A80036" points="333,528.6348,323,532.6348,333,536.6348,329,532.6348" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="327" x2="768" y1="532.6348" y2="532.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="339" y="527.8926">List&lt;ProductStock&gt;</text><polygon fill="#A80036" points="463,573.2559,473,577.2559,463,581.2559,467,577.2559" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="322" x2="469" y1="577.2559" y2="577.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="329" y="557.2031">checkStock</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="329" y="572.5137">(List&lt;ProductStock&gt;)</text><polygon fill="#A80036" points="333,613.2217,323,617.2217,333,621.2217,329,617.2217" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="327" x2="479" y1="617.2217" y2="617.2217"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="339" y="612.4795">boolean</text><path d="M490,590.2559 L490,630.2559 L650,630.2559 L650,600.2559 L640,590.2559 L490,590.2559 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><path d="M640,590.2559 L640,600.2559 L650,600.2559 L640,590.2559 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="496" y="607.8242">・Orderの数量と在庫を</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="496" y="623.1348">　比較してチェック</text><polygon fill="#A80036" points="543.5,653.1875,553.5,657.1875,543.5,661.1875,547.5,657.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="322" x2="549.5" y1="657.1875" y2="657.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="329" y="652.4453">insert(Order)</text><polygon fill="#A80036" points="912,682.498,922,686.498,912,690.498,916,686.498" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="565.5" x2="918" y1="686.498" y2="686.498"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="572.5" y="681.7559">SQL(INSERT)</text><polygon fill="#A80036" points="576.5,711.8086,566.5,715.8086,576.5,719.8086,572.5,715.8086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="570.5" x2="928" y1="715.8086" y2="715.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="582.5" y="711.0664">viod</text><polygon fill="#A80036" points="333,741.1191,323,745.1191,333,749.1191,329,745.1191" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="327" x2="559.5" y1="745.1191" y2="745.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="339" y="740.377">viod</text><polygon fill="#A80036" points="643.5,770.4297,653.5,774.4297,643.5,778.4297,647.5,774.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="322" x2="649.5" y1="774.4297" y2="774.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="329" y="769.6875">insert(OrderDetail)</text><polygon fill="#A80036" points="912,799.7402,922,803.7402,912,807.7402,916,803.7402" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="665.5" x2="918" y1="803.7402" y2="803.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="672.5" y="798.998">SQL(INSERT)</text><polygon fill="#A80036" points="676.5,829.0508,666.5,833.0508,676.5,837.0508,672.5,833.0508" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="670.5" x2="928" y1="833.0508" y2="833.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="682.5" y="828.3086">viod</text><polygon fill="#A80036" points="333,858.3613,323,862.3613,333,866.3613,329,862.3613" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="327" x2="659.5" y1="862.3613" y2="862.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="339" y="857.6191">viod</text><polygon fill="#A80036" points="752,887.6719,762,891.6719,752,895.6719,756,891.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="322" x2="758" y1="891.6719" y2="891.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="329" y="886.9297">update(ProductStock)</text><polygon fill="#A80036" points="912,916.9824,922,920.9824,912,924.9824,916,920.9824" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="774" x2="918" y1="920.9824" y2="920.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="781" y="916.2402">SQL(UPDATE)</text><polygon fill="#A80036" points="785,946.293,775,950.293,785,954.293,781,950.293" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="779" x2="928" y1="950.293" y2="950.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="791" y="945.5508">viod</text><polygon fill="#A80036" points="333,975.6035,323,979.6035,333,983.6035,329,979.6035" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="327" x2="768" y1="979.6035" y2="979.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="339" y="974.8613">viod</text><line style="stroke:#A80036;stroke-width:1.0;" x1="322" x2="364" y1="1024.2246" y2="1024.2246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="364" x2="364" y1="1024.2246" y2="1037.2246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323" x2="364" y1="1037.2246" y2="1037.2246"/><polygon fill="#A80036" points="333,1033.2246,323,1037.2246,333,1041.2246,329,1037.2246" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="329" y="1004.1719">メール送信</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="329" y="1019.4824">sendMail(Order)</text><path d="M440,996.1035 L440,1036.1035 L682,1036.1035 L682,1006.1035 L672,996.1035 L440,996.1035 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><path d="M672,996.1035 L672,1006.1035 L682,1006.1035 L672,996.1035 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="446" y="1013.6719">・顧客メールアドレス宛にメール送信</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="446" y="1028.9824">・注文内容と振込先を送信</text><polygon fill="#A80036" points="192,1062.5352,182,1066.5352,192,1070.5352,188,1066.5352" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="186" x2="316" y1="1066.5352" y2="1066.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="198" y="1061.793">viod</text><polygon fill="#A80036" points="45,1091.8457,35,1095.8457,45,1099.8457,41,1095.8457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="39" x2="175" y1="1095.8457" y2="1095.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="51" y="1091.1035">リダイレクト</text><polygon fill="#A80036" points="159,1121.1563,169,1125.1563,159,1129.1563,163,1125.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="34" x2="165" y1="1125.1563" y2="1125.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="41" y="1120.4141">complete()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="181" x2="223" y1="1154.4668" y2="1154.4668"/><line style="stroke:#A80036;stroke-width:1.0;" x1="223" x2="223" y1="1154.4668" y2="1167.4668"/><line style="stroke:#A80036;stroke-width:1.0;" x1="182" x2="223" y1="1167.4668" y2="1167.4668"/><polygon fill="#A80036" points="192,1163.4668,182,1167.4668,192,1171.4668,188,1167.4668" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="188" y="1149.7246">セッション解除</text><polygon fill="#A80036" points="45,1192.7773,35,1196.7773,45,1200.7773,41,1196.7773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="39" x2="175" y1="1196.7773" y2="1196.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="51" y="1192.0352">完了画面</text><!--MD5=[ee8d7c58ebf62c073159f945a2cefd4f]
@startuml
skin rose
skinparam shadowing false
hide empty methods
hide empty fields
skin rose
title UC005: 購入確定 シーケンス図
skinparam shadowing false
actor "ユーザ" as user
activate user
participant "Order\nController" as ctrl
participant "Order\nService" as svc
participant "Order" as od
participant "Order\nRepository" as repo1
participant "OrderDetail\nRepository" as repo2
' participant "OrderStatus\nRepository" as repo3
participant "ProductStock\nRepository" as repo4
database DB as db

' 確認画面
user -> ctrl ++ : confirm(productId)
ctrl -> ctrl : カートの中身を表示
ctrl -> user - - : 確認画面

' 完了画面
user -> ctrl ++ : execute()
note right
    未ログインだったら
    ログイン画面を出す
end note
ctrl -> od : new(カート内容をエンティティに変換)
ctrl <- - od : Order
ctrl -> svc ++ : addOrder(Order)
note right
    ・在庫数を取得して
    　購入できるか確認
    　（悲観的ロック）
    ・トランザクション処理
end note
svc -> repo4 ++ : selectStockList(List<Product>)
repo4 -> db ++ : SQL(SELECT)
repo4 <- - db - - : List<ProductStock>
svc <- - repo4 - - : List<ProductStock>
svc -> od ++ : checkStock\n(List<ProductStock>)
svc <- - od - - : boolean
note right
    ・Orderの数量と在庫を
    　比較してチェック
end note
svc -> repo1 ++ : insert(Order)
repo1 -> db ++ : SQL(INSERT)
repo1 <- - db - - : viod
svc <- - repo1 - - : viod
svc -> repo2 ++ : insert(OrderDetail)
repo2 -> db ++ : SQL(INSERT)
repo2 <- - db - - : viod
svc <- - repo2 - - : viod
svc -> repo4 ++ : update(ProductStock)
repo4 -> db ++ : SQL(UPDATE)
repo4 <- - db - - : viod
svc <- - repo4 - - : viod 
svc -> svc : メール送信\nsendMail(Order)
note right
    ・顧客メールアドレス宛にメール送信
    ・注文内容と振込先を送信
end note
ctrl <- - svc - - : viod
user <- - ctrl - - : リダイレクト
user -> ctrl ++ : complete()
ctrl -> ctrl : セッション解除
ctrl - -> user - - : 完了画面

@enduml

@startuml
skin rose
skinparam shadowing false
hide empty methods
hide empty fields
skin rose
title UC005: 購入確定 シーケンス図
skinparam shadowing false
actor "ユーザ" as user
activate user
participant "Order\nController" as ctrl
participant "Order\nService" as svc
participant "Order" as od
participant "Order\nRepository" as repo1
participant "OrderDetail\nRepository" as repo2
participant "ProductStock\nRepository" as repo4
database DB as db

user -> ctrl ++ : confirm(productId)
ctrl -> ctrl : カートの中身を表示
ctrl -> user - - : 確認画面

user -> ctrl ++ : execute()
note right
    未ログインだったら
    ログイン画面を出す
end note
ctrl -> od : new(カート内容をエンティティに変換)
ctrl <- - od : Order
ctrl -> svc ++ : addOrder(Order)
note right
    ・在庫数を取得して
    　購入できるか確認
    　（悲観的ロック）
    ・トランザクション処理
end note
svc -> repo4 ++ : selectStockList(List<Product>)
repo4 -> db ++ : SQL(SELECT)
repo4 <- - db - - : List<ProductStock>
svc <- - repo4 - - : List<ProductStock>
svc -> od ++ : checkStock\n(List<ProductStock>)
svc <- - od - - : boolean
note right
    ・Orderの数量と在庫を
    　比較してチェック
end note
svc -> repo1 ++ : insert(Order)
repo1 -> db ++ : SQL(INSERT)
repo1 <- - db - - : viod
svc <- - repo1 - - : viod
svc -> repo2 ++ : insert(OrderDetail)
repo2 -> db ++ : SQL(INSERT)
repo2 <- - db - - : viod
svc <- - repo2 - - : viod
svc -> repo4 ++ : update(ProductStock)
repo4 -> db ++ : SQL(UPDATE)
repo4 <- - db - - : viod
svc <- - repo4 - - : viod 
svc -> svc : メール送信\nsendMail(Order)
note right
    ・顧客メールアドレス宛にメール送信
    ・注文内容と振込先を送信
end note
ctrl <- - svc - - : viod
user <- - ctrl - - : リダイレクト
user -> ctrl ++ : complete()
ctrl -> ctrl : セッション解除
ctrl - -> user - - : 完了画面

@enduml

PlantUML version 1.2022.5(Sat Apr 30 19:55:52 JST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>